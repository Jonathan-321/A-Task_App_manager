<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>List Add</title>
    <link rel="stylesheet" type="text/css" href="style.css" />
  </head>
  <body>
    <h2>List Add</h2>
    <div class="block-center">
      <p><span id="page-message">Enter fields and click Save</span></p>
      <p><span class="error-head">* required field.</span></p>
      <form id="listForm" onsubmit="submitForm(event)">
        Name: <input type="text" id="name" />
        <span id="nameErr" class="error">* </span>
        <br /><br />
        <input type="submit" name="submit" value="Save" />
      </form>


      <form action="todo-list.html" method="get" id="cancelForm">
        <button type="submit">Cancel</button>
      </form>

    </div>
    <script>
      function submitForm(e) {
        e.preventDefault();
        var name = document.getElementById("name").value;
        var data = JSON.stringify({ name: name });

        var xmlhttp = new XMLHttpRequest();
        xmlhttp.onreadystatechange = function () {
          if (this.readyState === 4) {
            if (this.status === 201) {

              // Parse the response JSON
              var response = JSON.parse(this.responseText);

              // Extract the list ID from the response 

              var listId = response.listId;

              // Navigate to todo-list.html with the list ID as a query parameter 

              // window to todo-list.html after successful save 
              window.location.href = "todo-list.html?id=" + listId;
            } else {
              document.getElementById("page-message").innerHTML =
                "Error:" + this.statusText;
            }
          }
        };
        xmlhttp.open("POST", "/todoapi/lists", true);
        xmlhttp.setRequestHeader("Content-type", "application/json");
        xmlhttp.send(data);
      }
    </script>
  </body>
</html>